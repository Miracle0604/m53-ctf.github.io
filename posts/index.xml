<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on M53</title>
        <link>https://m53-ctf.github.io/posts/</link>
        <description>Recent content in Posts on M53</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
        <lastBuildDate>Sun, 09 Apr 2023 21:01:30 +0800</lastBuildDate>
        <atom:link href="https://m53-ctf.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>[VishwaCTF] Ethereal Crackme</title>
            <link>https://m53-ctf.github.io/posts/vishwactf2023-etherealcrackme/</link>
            <pubDate>Sun, 09 Apr 2023 21:01:30 +0800</pubDate>
            
            <guid>https://m53-ctf.github.io/posts/vishwactf2023-etherealcrackme/</guid>
            <description>This challenge provided a two windows executable files called HauntedImage.exe and HauntedCursor.exe.
Please note that I did not solve this challenge during the competition, only solved it after the competition without completely understanding the challenge.
HauntedImage.exe Analysis Looking at the binary we noticed that it was huge and looks unlikely to be reverse within 1-2 days (atleast for me). Therefore we chose to execute the binary directly, and it will generate a corrupted image called result.</description>
            <content type="html"><![CDATA[<p>This challenge provided a two windows executable files called <code>HauntedImage.exe</code> and <code>HauntedCursor.exe</code>.</p>
<p>Please note that I did not solve this challenge during the competition, only solved it after the competition without completely understanding the challenge.</p>
<h2 id="hauntedimageexe-analysis">HauntedImage.exe Analysis</h2>
<p>Looking at the binary we noticed that it was huge and looks unlikely to be reverse within 1-2 days (atleast for me). Therefore we chose to execute the binary directly, and it will generate a corrupted image called <code>result.jpg</code>. Looking at <code>result.jpg</code> in Hex Editor tell us that it was not related to a valid image at all. One hint provided by organizer: &ldquo;The image is not corrupted&rdquo; indirectly tell us that we should try out few things. What we did is we simply execute the <code>HauntedImage.exe</code> again, but this time specifying the <code>result.jpg</code> as argument. And the <code>result.jpg</code> will changed to a valid picture with an URL in it like following:</p>
<p><img src="/images/ctfs/vishwactf2023-etherealcrackme/1.png" alt="IMG"></p>
<p>The URL will lead us to download a Cursor Image file. And that&rsquo;s the information I managed to get during the CTF for this binary. Only after the CTF I found out that running the binary again with the cursor image file will generate the Ouija Board image, which will be useful but not necessary for us.</p>
<h2 id="hauntedcursorexe-analysis">HauntedCursor.exe Analysis</h2>
<p>TLDR: This binary is in charge for pointing our cursor to the correct position based on the Ouija Board.</p>
<p>The first part of the binary is basically finding for a window called <code>MSPaintApp</code>. That means that in order to exit out of this loop, we have to open MSPaintApp.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    lpWideCharStr <span style="color:#f92672">=</span> <span style="color:#e6db74">L</span><span style="color:#e6db74">&#34;MSPaintApp&#34;</span>;
</span></span><span style="display:flex;"><span>    cbMultiByte <span style="color:#f92672">=</span> <span style="color:#a6e22e">WideCharToMultiByte</span>(<span style="color:#ae81ff">0xFDE9u</span>, <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">L</span><span style="color:#e6db74">&#34;MSPaintApp&#34;</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>i64, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>i64, <span style="color:#ae81ff">0</span>i64);
</span></span><span style="display:flex;"><span>    lpMultiByteStr <span style="color:#f92672">=</span> (LPSTR)operator new[](cbMultiByte);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">WideCharToMultiByte</span>(<span style="color:#ae81ff">0xFDE9u</span>, <span style="color:#ae81ff">0</span>, lpWideCharStr, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, lpMultiByteStr, cbMultiByte, <span style="color:#ae81ff">0</span>i64, <span style="color:#ae81ff">0</span>i64);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> ( <span style="color:#f92672">!</span><span style="color:#a6e22e">FindWindowA</span>(lpMultiByteStr, <span style="color:#ae81ff">0</span>i64) );
</span></span></code></pre></div><p>The following part of the binary in main function will render the string <code>&quot;I NEED TO TALK TO YOU BUT I CAN DO IT ONLY THROUGH THE OUIJA BOARD.....\nPress enter to go to the next step..&quot;</code> on the screen and wait for our Enter key input to proceed. After that, the program will check for number of arguments we provided, convert the argument to integer and pass to function <code>checkSecondStep(v18);</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>Gdiplus<span style="color:#f92672">::</span>GdiplusStartupInput<span style="color:#f92672">::</span><span style="color:#a6e22e">GdiplusStartupInput</span>((Gdiplus<span style="color:#f92672">::</span>GdiplusStartupInput <span style="color:#f92672">*</span>)v15, <span style="color:#ae81ff">0</span>i64, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">GdiplusStartup</span>(v14, v15, <span style="color:#ae81ff">0</span>i64);
</span></span><span style="display:flex;"><span>DC <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetDC</span>(<span style="color:#ae81ff">0</span>i64);
</span></span><span style="display:flex;"><span>Gdiplus<span style="color:#f92672">::</span>Graphics<span style="color:#f92672">::</span><span style="color:#a6e22e">Graphics</span>((Gdiplus<span style="color:#f92672">::</span>Graphics <span style="color:#f92672">*</span>)v13, DC);
</span></span><span style="display:flex;"><span>Gdiplus<span style="color:#f92672">::</span>FontFamily<span style="color:#f92672">::</span><span style="color:#a6e22e">FontFamily</span>(v12, <span style="color:#e6db74">L</span><span style="color:#e6db74">&#34;Times New Roman&#34;</span>, <span style="color:#ae81ff">0</span>i64);
</span></span><span style="display:flex;"><span>Gdiplus<span style="color:#f92672">::</span>Font<span style="color:#f92672">::</span><span style="color:#a6e22e">Font</span>((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)v11, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)v12, v3, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>Gdiplus<span style="color:#f92672">::</span>PointF<span style="color:#f92672">::</span><span style="color:#a6e22e">PointF</span>((Gdiplus<span style="color:#f92672">::</span>PointF <span style="color:#f92672">*</span>)v10, <span style="color:#ae81ff">500.0</span>, <span style="color:#ae81ff">500.0</span>);
</span></span><span style="display:flex;"><span>Gdiplus<span style="color:#f92672">::</span>Color<span style="color:#f92672">::</span><span style="color:#a6e22e">Color</span>((Gdiplus<span style="color:#f92672">::</span>Color <span style="color:#f92672">*</span>)v16, <span style="color:#ae81ff">0xFFu</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0xFFu</span>);
</span></span><span style="display:flex;"><span>Gdiplus<span style="color:#f92672">::</span>SolidBrush<span style="color:#f92672">::</span><span style="color:#a6e22e">SolidBrush</span>((Gdiplus<span style="color:#f92672">::</span>SolidBrush <span style="color:#f92672">*</span>)v9, (<span style="color:#66d9ef">const</span> Gdiplus<span style="color:#f92672">::</span>Color <span style="color:#f92672">*</span>)v16);
</span></span><span style="display:flex;"><span>Gdiplus<span style="color:#f92672">::</span>Graphics<span style="color:#f92672">::</span><span style="color:#a6e22e">DrawString</span>(
</span></span><span style="display:flex;"><span>    (Gdiplus<span style="color:#f92672">::</span>Graphics <span style="color:#f92672">*</span>)v13,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">L</span><span style="color:#e6db74">&#34;I NEED TO TALK TO YOU BUT I CAN DO IT ONLY THROUGH THE OUIJA BOARD.....</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Press enter to go to the next step..&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">const</span> Gdiplus<span style="color:#f92672">::</span>Font <span style="color:#f92672">*</span>)v11,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">const</span> Gdiplus<span style="color:#f92672">::</span>PointF <span style="color:#f92672">*</span>)v10,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">const</span> Gdiplus<span style="color:#f92672">::</span>Brush <span style="color:#f92672">*</span>)v9);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">GetAsyncKeyState</span>(<span style="color:#ae81ff">13</span>) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> v24 )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    v24 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_IAT_start__</span>(DC);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( argc <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>allocator<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;::</span><span style="color:#a6e22e">allocator</span>(<span style="color:#f92672">&amp;</span>v17);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>__cxx11<span style="color:#f92672">::</span>basic_string<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span>,std<span style="color:#f92672">::</span>char_traits<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;</span>,std<span style="color:#f92672">::</span>allocator<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;&gt;::</span><span style="color:#a6e22e">basic_string</span>(v8, argv[<span style="color:#ae81ff">1</span>], <span style="color:#f92672">&amp;</span>v17);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>allocator<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;::~</span><span style="color:#a6e22e">allocator</span>(<span style="color:#f92672">&amp;</span>v17);
</span></span><span style="display:flex;"><span>    v5 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)std<span style="color:#f92672">::</span>__cxx11<span style="color:#f92672">::</span>basic_string<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span>,std<span style="color:#f92672">::</span>char_traits<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;</span>,std<span style="color:#f92672">::</span>allocator<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;&gt;::</span><span style="color:#a6e22e">c_str</span>(v8);
</span></span><span style="display:flex;"><span>    v18 <span style="color:#f92672">=</span> <span style="color:#a6e22e">atoi</span>(v5);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">checkSecondStep</span>(v18);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>__cxx11<span style="color:#f92672">::</span>basic_string<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span>,std<span style="color:#f92672">::</span>char_traits<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;</span>,std<span style="color:#f92672">::</span>allocator<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;&gt;::~</span><span style="color:#a6e22e">basic_string</span>(v8);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">checkSecondStep</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    v6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    v6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Looking into <code>checkSecondStep</code> function, it basically executing the <code>movePointer</code> function in while loop:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#66d9ef">__int64</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">checkSecondStep</span>(<span style="color:#66d9ef">int</span> a1)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> ( <span style="color:#f92672">!</span>(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)<span style="color:#a6e22e">movePointer</span>(a1) );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>i64;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Looking into <code>movePointer</code> function, it basically go through some Desktop Window checking, extract pixel from it, do some comparison and lastly set the cursor pointer position to the flag characters:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#66d9ef">__int64</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">movePointer</span>(<span style="color:#66d9ef">int</span> a1)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">struct</span> tagPOINT Point; <span style="color:#75715e">// [rsp+24h] [rbp-4Ch] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LONG y; <span style="color:#75715e">// [rsp+2Ch] [rbp-44h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  LONG x; <span style="color:#75715e">// [rsp+30h] [rbp-40h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v5; <span style="color:#75715e">// [rsp+34h] [rbp-3Ch]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v6; <span style="color:#75715e">// [rsp+38h] [rbp-38h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v7; <span style="color:#75715e">// [rsp+3Ch] [rbp-34h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v8; <span style="color:#75715e">// [rsp+40h] [rbp-30h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  COLORREF v9; <span style="color:#75715e">// [rsp+44h] [rbp-2Ch]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  HDC hDC; <span style="color:#75715e">// [rsp+48h] [rbp-28h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  HWND DesktopWindow; <span style="color:#75715e">// [rsp+50h] [rbp-20h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  COLORREF Pixel; <span style="color:#75715e">// [rsp+5Ch] [rbp-14h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  HDC hdc; <span style="color:#75715e">// [rsp+60h] [rbp-10h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  HWND hWnd; <span style="color:#75715e">// [rsp+68h] [rbp-8h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  hWnd <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetDesktopWindow</span>();
</span></span><span style="display:flex;"><span>  hdc <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetDC</span>(hWnd);
</span></span><span style="display:flex;"><span>  Pixel <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetPixel</span>(hdc, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ReleaseDC</span>(hWnd, hdc);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( (_BYTE)Pixel <span style="color:#f92672">==</span> <span style="color:#ae81ff">38</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">*</span>(_WORD <span style="color:#f92672">*</span>)((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>Pixel <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">10302</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    DesktopWindow <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetDesktopWindow</span>();
</span></span><span style="display:flex;"><span>    hDC <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetDC</span>(DesktopWindow);
</span></span><span style="display:flex;"><span>    v9 <span style="color:#f92672">=</span> <span style="color:#a6e22e">GetPixel</span>(hDC, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    v8 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span>)v9;
</span></span><span style="display:flex;"><span>    v7 <span style="color:#f92672">=</span> <span style="color:#a6e22e">BYTE1</span>(v9);
</span></span><span style="display:flex;"><span>    v6 <span style="color:#f92672">=</span> <span style="color:#a6e22e">BYTE2</span>(v9);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ReleaseDC</span>(DesktopWindow, hDC);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (_BYTE)v9 <span style="color:#f92672">==</span> <span style="color:#ae81ff">62</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">*</span>(_WORD <span style="color:#f92672">*</span>)((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>v9 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">11592</span> )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">645</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( a1 <span style="color:#f92672">%</span> <span style="color:#ae81ff">645</span> )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">SetCursorPos</span>(<span style="color:#ae81ff">9999</span>, <span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">SetCursorPos</span>(<span style="color:#ae81ff">10000</span>, <span style="color:#ae81ff">10000</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">GetCursorPos</span>(<span style="color:#f92672">&amp;</span>Point);
</span></span><span style="display:flex;"><span>      x <span style="color:#f92672">=</span> Point.x;
</span></span><span style="display:flex;"><span>      y <span style="color:#f92672">=</span> Point.y;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.25416666</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.56388891</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.75312501</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.74537039</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.78489584</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.44074073</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.48645833</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.49166667</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.34791666</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.72314817</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.36458334</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.51851851</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.48958334</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.3425926</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.34218749</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.74722224</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.61406249</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.36851853</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.45885417</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.73703706</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.48802084</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.50185186</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.24947916</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.55740738</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.74635416</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.74166667</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.61354166</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.34722221</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.15364583</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.66018516</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.48333332</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.49907407</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.34583333</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.74722224</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SetCursorPos</span>((<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.37291667</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)x), (<span style="color:#66d9ef">int</span>)(<span style="color:#66d9ef">float</span>)(<span style="color:#ae81ff">0.52407408</span> <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)y));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x320u</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( <span style="color:#a6e22e">GetAsyncKeyState</span>(<span style="color:#ae81ff">13</span>) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>i64;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>i64;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>operator<span style="color:#f92672">&lt;&lt;&lt;</span>std<span style="color:#f92672">::</span>char_traits<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;&gt;</span>(refptr__ZSt4cout, <span style="color:#e6db74">&#34;Use the ouija board</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">0x12Cu</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>i64;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Honestly, I wasn&rsquo;t able to fulfill the conditions of Desktop Window it required to pass the check, therefore we will use debugger to bypass it by setting the RIP to the location where it start moving cursor. Moreover, the <code>a1</code>, which is the argument we have to provide will be use for a check eventually:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span>v5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">645</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ( a1 <span style="color:#f92672">%</span> <span style="color:#ae81ff">645</span> )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> ) <span style="color:#a6e22e">SetCursorPos</span>(<span style="color:#ae81ff">9999</span>, <span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With all the informations we obtained, we can start solving the challenge. First, open MSPaintApp and leave it aside. Next, open <code>HauntedCursor.exe</code> in your favourite debugger, set argument as <code>645</code> and set a breakpoint at <code>40155B</code> and run the program. Once you reached the breakpoint, change the RIP to <code>401673</code>:</p>
<p><img src="/images/ctfs/vishwactf2023-etherealcrackme/2.png" alt="IMG"></p>
<p>Before we run the program, we have to change our desktop wallpaper to the Ouija Board image we obtained earlier. imagine that if we wasn&rsquo;t able to obtain the Ouija Board earlier, we can simply download one from internet, it will work as well. Also, if you want to have more clearer cursor, you can change your cursor with the cursor image you obtained earlier.</p>
<p>With everything set, run the program and the cursor will point to the flag character by character!</p>
<h3 id="flag">Flag:</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-md" data-lang="md"><span style="display:flex;"><span>VishwaCTF{P0LT3RG3I5TP0INT3R}
</span></span></code></pre></div>]]></content>
        </item>
        
    </channel>
</rss>
